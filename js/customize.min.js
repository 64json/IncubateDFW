var customDir = "incubate/dfw/";
var imgDir = customDir + "img/";

$.getJSON(customDir + "customize.json", function (custom) {
    customize(custom);
    init(custom);
});

function customize(cs, prefix, $parent) {
    if ('undefined' === typeof prefix) prefix = '';
    if ('undefined' === typeof $parent) $parent = $(document);
    var keys = Object.keys(cs);
    $.each(keys, function (index, key) {
        var value = cs[key];
        switch (typeof value) {
            case 'object':
                var type = value.$type;
                if (!type) {
                    customize(value, prefix + key + '-');
                    break;
                }
                var value = value.$value;
            case 'string':
                var $element = $parent.find('[data-cs=' + prefix + key + ']');
                switch (type) {
                    case 'class':
                        $element.addClass(value);
                        break;
                    case 'image':
                        $element.attr('src', imgDir + value);
                        break;
                    case 'parallax':
                        $element.attr('src', imgDir + value);
                        $element.parent().parallax();
                        break;
                    case 'link':
                        $element.attr('href', value);
                        break;
                    case 'array':
                        $.each(value, function (index, obj) {
                            var temp_prefix = prefix + key + '-' + index;
                            var $template = $element.children('.template').clone();
                            $template.removeClass('template');
                            $template.attr('data-cs', temp_prefix);
                            var classes = Object.keys(obj);
                            $.each(classes, function (index, cls) {
                                $template.find('.' + cls).attr('data-cs', temp_prefix + '-' + cls);
                            });
                            customize(obj, temp_prefix + '-', $template);
                            $element.append($template);
                        });
                        break;
                    default:
                        $element.html(value);
                }
                break;
        }
    });
}